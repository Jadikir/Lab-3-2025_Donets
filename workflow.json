{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1
              ],
              "triggerAtHour": 7
            }
          ]
        }
      },
      "id": "c3e028ce-fcca-495c-a580-4e7eb2917be7",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        1180,
        500
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:8000/predict",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.api_request_object }}",
        "options": {}
      },
      "id": "827323ca-806a-477f-a188-42f32085edaf",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1840,
        500
      ]
    },
    {
      "parameters": {
        "jsCode": "// \"Generate Dates\" node - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π\nconst today = new Date();\nconst dates = [];\n\nfor (let i = 1; i <= 7; i++) {\n  const date = new Date(today);\n  date.setDate(today.getDate() + i);\n  \n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  \n  dates.push(`${year}-${month}-${day}`);\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º dates –∫–∞–∫ –º–∞—Å—Å–∏–≤\nreturn [{\n  json: {\n    dates: dates,  // –≠—Ç–æ –º–∞—Å—Å–∏–≤!\n    dates_as_array: dates,  // –î—É–±–ª–∏—Ä—É–µ–º –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏\n    dates_as_json_string: JSON.stringify(dates)  // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏\n  }\n}];"
      },
      "id": "7d8d837a-3432-466e-a384-f7baae9b500f",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1400,
        500
      ]
    },
    {
      "parameters": {
        "jsCode": "// Function node: Create API JSON\nconst dates = $input.first().json.dates;\n\n// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞\nconst requestBody = {\n  dates: dates,\n  city: \"austin\",\n  include_confidence: true\n};\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É JSON\nreturn [{\n  json: {\n    api_request_json: JSON.stringify(requestBody),\n    api_request_object: requestBody\n  }\n}];"
      },
      "id": "27743c85-532e-46b1-a8a8-0399fcd6476a",
      "name": "Code1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1620,
        500
      ]
    },
    {
      "parameters": {
        "jsCode": "// Format for Telegram node\nconst response = $input.first().json;\nconst predictions = response.predictions;\nconst metadata = response.metadata;\n\n// –≠–º–æ–¥–∑–∏ –¥–ª—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst dayEmojis = ['‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üå•Ô∏è', '‚òÅÔ∏è', 'üå¶Ô∏è', 'üåà'];\n// –ù–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏\nconst dayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];\n\n// –ó–∞–≥–æ–ª–æ–≤–æ–∫\nlet message = `üå§Ô∏è *–ü–†–û–ì–ù–û–ó –ü–û–ì–û–î–´ –ù–ê –ù–ï–î–ï–õ–Æ*\\n`;\nmessage += `üìç *–ì–æ—Ä–æ–¥:* ${metadata.city.toUpperCase()}\\n`;\nmessage += `üìÖ *–ü–µ—Ä–∏–æ–¥:* ${predictions[0].date} - ${predictions[predictions.length-1].date}\\n\\n`;\n\n// –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è —à–∫–∞–ª–∞ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏\nfunction getTempEmoji(temp) {\n  if (temp < 0) return '‚ùÑÔ∏è';      // –º–æ—Ä–æ–∑\n  else if (temp < 10) return 'ü•∂'; // —Ö–æ–ª–æ–¥–Ω–æ\n  else if (temp < 20) return 'üòä'; // –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ\n  else if (temp < 30) return 'üòé'; // –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ\n  else if (temp < 35) return 'üî•'; // –∂–∞—Ä–∫–æ\n  else return '‚òÄÔ∏è';               // –æ—á–µ–Ω—å –∂–∞—Ä–∫–æ\n}\n\nfunction getTempBar(temp) {\n  // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–æ—Ç 0 –¥–æ 40¬∞C)\n  const normalized = Math.min(40, Math.max(0, temp));\n  const bars = Math.round(normalized / 2); // 1 –±–∞—Ä = 2¬∞C\n  return '‚ñ∞'.repeat(bars) + '‚ñ±'.repeat(20 - bars);\n}\n\n// –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ –¥–Ω—è–º\npredictions.forEach((pred, index) => {\n  const date = new Date(pred.date);\n  const dayName = dayNames[date.getDay()];\n  const dayEmoji = dayEmojis[index % dayEmojis.length];\n  \n  message += `${dayEmoji} *${dayName} ${pred.date}:*\\n`;\n  message += `   üå°Ô∏è ${pred.temperature_c.toFixed(1)}¬∞C (${pred.temperature_f.toFixed(1)}¬∞F)\\n`;\n  \n  // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è\n  message += `   ${getTempBar(pred.temperature_c)} ${getTempEmoji(pred.temperature_c)}\\n`;\n  \n  // –î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª\n  if (pred.confidence_interval) {\n    const ci = pred.confidence_interval;\n    const range = (ci.upper - ci.lower).toFixed(1);\n    message += `   üìä –î–æ–≤–µ—Ä–∏–µ: ${ci.lower}¬∞C - ${ci.upper}¬∞C (¬±${range}¬∞C)\\n`;\n  }\n  \n  // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è\n  let recommendation = '';\n  if (pred.temperature_c < 5) recommendation = '‚ùÑÔ∏è –û–¥–µ–≤–∞–π—Ç–µ—Å—å –æ—á–µ–Ω—å —Ç–µ–ø–ª–æ!';\n  else if (pred.temperature_c < 15) recommendation = 'üß• –ù–∞–¥–µ–Ω—å—Ç–µ –∫—É—Ä—Ç–∫—É';\n  else if (pred.temperature_c < 25) recommendation = 'üëï –ò–¥–µ–∞–ª—å–Ω–∞—è –ø–æ–≥–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫';\n  else if (pred.temperature_c < 30) recommendation = 'ü©≥ –ú–æ–∂–Ω–æ –≤ —à–æ—Ä—Ç–∞—Ö';\n  else recommendation = 'üßä –ü–µ–π—Ç–µ –±–æ–ª—å—à–µ –≤–æ–¥—ã!';\n  \n  message += `   üí° ${recommendation}\\n\\n`;\n});\n\n// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\nconst avgTemp = (predictions.reduce((sum, p) => sum + p.temperature_c, 0) / predictions.length).toFixed(1);\nconst minTemp = Math.min(...predictions.map(p => p.temperature_c)).toFixed(1);\nconst maxTemp = Math.max(...predictions.map(p => p.temperature_c)).toFixed(1);\n\nmessage += `üìà *–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ù–ï–î–ï–õ–ò:*\\n`;\nmessage += `   üìä –°—Ä–µ–¥–Ω—è—è: ${avgTemp}¬∞C\\n`;\nmessage += `   ‚¨áÔ∏è –ú–∏–Ω–∏–º—É–º: ${minTemp}¬∞C\\n`;\nmessage += `   ‚¨ÜÔ∏è –ú–∞–∫—Å–∏–º—É–º: ${maxTemp}¬∞C\\n\\n`;\n\n// –ü—Ä–æ–≥–Ω–æ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\nmessage += `‚ÑπÔ∏è *–ò–ù–§–û–†–ú–ê–¶–ò–Ø:*\\n`;\nmessage += `   üèôÔ∏è –ì–æ—Ä–æ–¥: ${metadata.city}\\n`;\nmessage += `   ü§ñ –ú–æ–¥–µ–ª—å: ${metadata.model_type}\\n`;\nmessage += `   ‚è∞ –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(metadata.prediction_time).toLocaleString('ru-RU')}\\n`;\nmessage += `   üìÖ –î–Ω–µ–π –≤ –ø—Ä–æ–≥–Ω–æ–∑–µ: ${metadata.total_dates}\\n\\n`;\n\nmessage += `_–ü—Ä–æ–≥–Ω–æ–∑ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é_ ‚ú®`;\n\nreturn [{\n  json: {\n    ...$input.first().json,\n    telegram_message: message,\n    stats: {\n      avg_temp: avgTemp,\n      min_temp: minTemp,\n      max_temp: maxTemp,\n      city: metadata.city\n    }\n  }\n}];"
      },
      "id": "909cd48b-3db1-43f5-b8e5-c9074e1aa829",
      "name": "Code2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2060,
        500
      ]
    },
    {
      "parameters": {
        "chatId": "645259904",
        "text": "=1 {{ $json.telegram_message }}",
        "additionalFields": {}
      },
      "id": "5d9b124f-dcc1-4fc5-a856-8b2130d24513",
      "name": "Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        2280,
        500
      ],
      "credentials": {
        "telegramApi": {
          "id": "haEHOH4X1xLkZ2pE",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2fb12274-037d-4656-bad9-36886339d0f9",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "91168cb9dab1d51aa40e4d988b6b4d0badbd085170a6bd921943881fa5250071"
  },
  "id": "8nYlxVNRKjmFcz9w",
  "tags": []
}